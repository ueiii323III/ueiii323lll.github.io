{"version":3,"file":"WorkEdit-fmqSALcs.js","sources":["../../src/views/admin/WorkEdit.vue"],"sourcesContent":["<template>\r\n  <div class=\"work-edit\">\r\n    <div class=\"page-header\">\r\n      <h2>{{ isEdit ? '编辑作品' : '添加作品' }}</h2>\r\n      <div class=\"header-actions\">\r\n        <t-button @click=\"goBack\" variant=\"outline\">\r\n          <t-icon name=\"chevron-left\" />\r\n          返回\r\n        </t-button>\r\n      </div>\r\n    </div>\r\n\r\n    <div class=\"edit-container\">\r\n      <t-card>\r\n        <t-form :data=\"form\" :rules=\"formRules\" @submit=\"handleSubmit\">\r\n          <t-form-item label=\"作品标题\" name=\"title\">\r\n            <t-input v-model=\"form.title\" placeholder=\"请输入作品标题\" />\r\n          </t-form-item>\r\n          \r\n          <t-form-item label=\"作品描述\" name=\"description\">\r\n            <t-textarea \r\n              v-model=\"form.description\" \r\n              placeholder=\"请输入作品描述\"\r\n              :autosize=\"{ minRows: 4, maxRows: 8 }\"\r\n            />\r\n          </t-form-item>\r\n          \r\n          <t-form-item label=\"作品分类\" name=\"category\">\r\n            <t-select v-model=\"form.category\" placeholder=\"请选择作品分类\">\r\n              <t-option value=\"photography\" label=\"摄影\" />\r\n              <t-option value=\"painting\" label=\"绘画\" />\r\n              <t-option value=\"digital\" label=\"数字艺术\" />\r\n              <t-option value=\"cityscape\" label=\"城市印象\" />\r\n            </t-select>\r\n          </t-form-item>\r\n          \r\n          <t-form-item label=\"标签\" name=\"tags\">\r\n            <t-tag-input v-model=\"form.tags\" placeholder=\"输入标签后按回车添加\" />\r\n          </t-form-item>\r\n          \r\n          <t-form-item label=\"缩略图\" name=\"thumbnail\">\r\n            <t-upload\r\n              v-model=\"form.thumbnail\"\r\n              action=\"/api/upload\"\r\n              theme=\"file-input\"\r\n              accept=\"image/*\"\r\n              :max-size=\"5\"\r\n              tips=\"支持 jpg、png 格式，文件大小不超过 5MB\"\r\n            />\r\n          </t-form-item>\r\n          \r\n          <t-form-item label=\"发布状态\" name=\"isPublished\">\r\n            <t-switch v-model=\"form.isPublished\">\r\n              <template #label>{{ form.isPublished ? '已发布' : '草稿' }}</template>\r\n            </t-switch>\r\n          </t-form-item>\r\n          \r\n          <div class=\"form-actions\">\r\n            <t-button theme=\"primary\" type=\"submit\" :loading=\"submitting\">\r\n              {{ isEdit ? '更新作品' : '添加作品' }}\r\n            </t-button>\r\n            <t-button theme=\"default\" variant=\"outline\" @click=\"goBack\">\r\n              取消\r\n            </t-button>\r\n          </div>\r\n        </t-form>\r\n      </t-card>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport { ref, computed, onMounted } from 'vue'\r\nimport { useRouter, useRoute } from 'vue-router'\r\nimport { MessagePlugin } from 'tdesign-vue-next'\r\nimport { useWorksStore } from '@/stores/works'\r\nimport type { WorkCategory } from '@/types/admin'\r\n\r\nconst router = useRouter()\r\nconst route = useRoute()\r\nconst worksStore = useWorksStore()\r\n\r\nconst submitting = ref(false)\r\n\r\n// 表单数据\r\nconst form = ref({\r\n  title: '',\r\n  description: '',\r\n  category: 'photography' as WorkCategory,\r\n  tags: [] as string[],\r\n  thumbnail: '',\r\n  fullImage: '',\r\n  isPublished: true,\r\n  order: 1\r\n})\r\n\r\n// 表单验证规则\r\nconst formRules = {\r\n  title: [{ required: true, message: '请输入作品标题' }],\r\n  description: [{ required: true, message: '请输入作品描述' }],\r\n  category: [{ required: true, message: '请选择作品分类' }],\r\n  thumbnail: [{ required: true, message: '请上传缩略图' }]\r\n}\r\n\r\n// 是否为编辑模式\r\nconst isEdit = computed(() => route.name === 'admin-work-edit')\r\n\r\n// 初始化数据\r\nonMounted(() => {\r\n  if (isEdit.value) {\r\n    const workId = route.params.id as string\r\n    const work = worksStore.works.find(w => w.id === workId)\r\n    \r\n    if (work) {\r\n      form.value = {\r\n        title: work.title,\r\n        description: work.description,\r\n        category: work.category,\r\n        tags: [...work.tags],\r\n        thumbnail: work.thumbnail || '',\r\n        fullImage: work.fullImage || '',\r\n        isPublished: work.isPublished,\r\n        order: work.order\r\n      }\r\n    }\r\n  }\r\n})\r\n\r\n// 提交表单\r\nconst handleSubmit = async ({ validateResult, firstError }: any) => {\r\n  if (!validateResult) {\r\n    MessagePlugin.error(firstError.message)\r\n    return\r\n  }\r\n  \r\n  submitting.value = true\r\n  \r\n  try {\r\n    if (isEdit.value) {\r\n      const workId = route.params.id as string\r\n      await worksStore.updateWork(workId, form.value)\r\n      MessagePlugin.success('作品更新成功')\r\n    } else {\r\n      await worksStore.addWork(form.value)\r\n      MessagePlugin.success('作品添加成功')\r\n    }\r\n    \r\n    router.push('/admin/works')\r\n  } catch (error) {\r\n    console.error('提交失败:', error)\r\n    MessagePlugin.error('操作失败，请重试')\r\n  } finally {\r\n    submitting.value = false\r\n  }\r\n}\r\n\r\n// 返回上一页\r\nconst goBack = () => {\r\n  router.push('/admin/works')\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n@import \"@/styles/variables.scss\";\r\n\r\n.work-edit {\r\n  max-width: 800px;\r\n  margin: 0 auto;\r\n  padding: $spacing-lg 0;\r\n}\r\n\r\n.page-header {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  margin-bottom: $spacing-xl;\r\n  \r\n  h2 {\r\n    margin: 0;\r\n    color: $text-primary;\r\n    font-size: 1.5rem;\r\n    font-weight: 600;\r\n  }\r\n}\r\n\r\n.edit-container {\r\n  .form-actions {\r\n    display: flex;\r\n    justify-content: flex-end;\r\n    gap: $spacing-md;\r\n    margin-top: $spacing-xl;\r\n  }\r\n}\r\n</style>"],"names":["router","useRouter","route","useRoute","worksStore","useWorksStore","submitting","ref","form","formRules","isEdit","computed","onMounted","workId","work","w","handleSubmit","validateResult","firstError","MessagePlugin","error","goBack","_openBlock","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_hoisted_3","_createVNode","_component_t_button","_component_t_icon","_hoisted_4","_component_t_card","_component_t_form","_component_t_form_item","_component_t_input","_cache","$event","_component_t_textarea","_component_t_select","_component_t_option","_component_t_tag_input","_component_t_upload","_component_t_switch","_createTextVNode","_toDisplayString","_hoisted_5"],"mappings":"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"}