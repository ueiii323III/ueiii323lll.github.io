<!--index.wxml-->
<navigation-bar title="å¥åº·æ‰“å¡" back="{{false}}" color="white" background="#FF91A4"></navigation-bar>
<scroll-view class="scrollarea" scroll-y type="list">
  <view class="container">
    <!-- æœªç™»å½•çŠ¶æ€ -->
    <view wx:if="{{!hasUserInfo}}" class="login-section">
      <view class="login-content">
        <view class="app-logo">ğŸƒâ€â™‚ï¸</view>
        <text class="app-title">å¥åº·ä¹ æƒ¯æ‰“å¡</text>
        <text class="app-desc">è®°å½•æ¯ä¸€å¤©ï¼Œæˆå°±æ›´å¥åº·çš„è‡ªå·±</text>
        <button class="login-btn" bindtap="handleLogin">
          <text class="wx-icon">ğŸ‘¤</text>
          å¾®ä¿¡å¿«é€Ÿç™»å½•
        </button>
        <button class="login-btn mock-btn" bindtap="handleMockLogin" style="margin-top: 10px; background: #2196F3;">
          <text class="wx-icon">ğŸ§ª</text>
          æ¨¡æ‹Ÿç™»å½•(å¼€å‘æµ‹è¯•)
        </button>
      </view>
    </view>

    <!-- å·²ç™»å½•ä½†æœªå®Œå–„ä¿¡æ¯ -->
    <view wx:elif="{{!isProfileComplete}}" class="profile-prompt">
      <view class="prompt-content">
        <view class="prompt-icon">ğŸ“</view>
        <text class="prompt-text">è¯·å®Œå–„æ‚¨çš„åŸºç¡€å¥åº·ä¿¡æ¯</text>
        <text class="prompt-desc">æˆ‘ä»¬å°†ä¸ºæ‚¨ç”Ÿæˆä¸ªæ€§åŒ–çš„å¥åº·ç›®æ ‡å’Œå»ºè®®</text>
        <button class="complete-btn" bindtap="navigateToProfile">å®Œå–„ä¿¡æ¯</button>
      </view>
    </view>

    <!-- å·²å®Œå–„ä¿¡æ¯ -->
    <view wx:else class="main-content">
      <!-- ç”¨æˆ·ä¿¡æ¯å¤´éƒ¨ -->
      <view class="user-header">
        <image class="user-avatar" src="{{userInfo.avatarUrl}}" mode="aspectFill"></image>
        <view class="user-info">
          <text class="user-name">{{userInfo.nickName}}</text>
          <text class="user-bmi">BMI: {{userProfile.bmi || '--'}} ({{userProfile.bmiCategory === 'normal' ? 'æ­£å¸¸' : userProfile.bmiCategory === 'underweight' ? 'åç˜¦' : userProfile.bmiCategory === 'overweight' ? 'è¶…é‡' : userProfile.bmiCategory === 'obese' ? 'è‚¥èƒ–' : 'æœªçŸ¥'}})</text>
        </view>
        <view class="today-complete">
          <text class="complete-text">{{todayStats.completedTasks}}/{{todayStats.totalTasks}}</text>
          <text class="complete-label">ä»Šæ—¥å®Œæˆ</text>
        </view>
      </view>

      <!-- ä»Šæ—¥ç»Ÿè®¡ -->
      <view class="stats-section">
        <view class="section-title">ä»Šæ—¥è¿›åº¦</view>
        <view class="stats-grid">
          <view class="stat-item" bindtap="navigateToWater">
            <view class="stat-icon water-icon">ğŸ’§</view>
            <text class="stat-value">{{todayStats.waterAmount}}ml</text>
            <text class="stat-label">é¥®æ°´</text>
            <view class="progress-bar">
              <view class="progress-fill water-fill" style="width: {{todayStats.waterProgress}}%"></view>
            </view>
          </view>
          
          <view class="stat-item" bindtap="navigateToFood">
            <view class="stat-icon food-icon">ğŸ½ï¸</view>
            <text class="stat-value">{{todayStats.calorieIntake}}kcal</text>
            <text class="stat-label">é¥®é£Ÿ</text>
            <view class="progress-bar">
              <view class="progress-fill food-fill" style="width: {{todayStats.calorieProgress}}%"></view>
            </view>
          </view>
          
          <view class="stat-item" bindtap="navigateToExercise">
            <view class="stat-icon exercise-icon">ğŸƒ</view>
            <text class="stat-value">{{todayStats.exerciseDuration}}min</text>
            <text class="stat-label">è¿åŠ¨</text>
            <view class="progress-bar">
              <view class="progress-fill exercise-fill" style="width: {{todayStats.exerciseProgress}}%"></view>
            </view>
          </view>
        </view>
      </view>

      <!-- å¿«é€Ÿè®°å½• -->
      <view class="quick-record">
        <view class="section-title">å¿«é€Ÿè®°å½•</view>
        <view class="record-grid">
          <view class="record-item">
            <text class="record-label">é¥®æ°´ (ml)</text>
            <view class="record-input-group">
              <input class="record-input" type="digit" placeholder="è¯·è¾“å…¥é¥®æ°´é‡" value="{{quickRecord.water}}" bindinput="onQuickWaterInput" />
              <button class="record-btn water-record-btn" bindtap="quickRecordWater">è®°å½•</button>
            </view>
          </view>
          
          <view class="record-item">
            <text class="record-label">è¿åŠ¨ (åˆ†é’Ÿ)</text>
            <view class="record-input-group">
              <input class="record-input" type="digit" placeholder="è¯·è¾“å…¥è¿åŠ¨æ—¶é•¿" value="{{quickRecord.exercise}}" bindinput="onQuickExerciseInput" />
              <button class="record-btn exercise-record-btn" bindtap="quickRecordExercise">è®°å½•</button>
            </view>
          </view>
        </view>
      </view>

      <!-- å¿«æ·æ‰“å¡ -->
      <view class="quick-actions">
        <view class="section-header">
          <text class="section-title">è¯¦ç»†è®°å½•</text>
          <button class="refresh-btn" bindtap="forceRefreshData">åˆ·æ–°</button>
        </view>
        <view class="action-grid">
          <button class="action-btn water-btn" bindtap="navigateToWater">
            <view class="btn-icon">ğŸ’§</view>
            <text class="btn-text">é¥®æ°´è®°å½•</text>
          </button>
          
          <button class="action-btn food-btn" bindtap="navigateToFood">
            <view class="btn-icon">ğŸ½ï¸</view>
            <text class="btn-text">é¥®é£Ÿè®°å½•</text>
          </button>
          
          <button class="action-btn exercise-btn" bindtap="navigateToExercise">
            <view class="btn-icon">ğŸƒ</view>
            <text class="btn-text">è¿åŠ¨è®°å½•</text>
          </button>
        </view>
      </view>

      <!-- å¥åº·å»ºè®® -->
      <view wx:if="{{healthAdvices.length > 0}}" class="advice-section">
        <view class="section-title">ä»Šæ—¥å»ºè®®</view>
        <view class="advice-list">
          <view wx:for="{{healthAdvices}}" wx:key="index" class="advice-item">
            <view class="advice-icon">ğŸ’¡</view>
            <text class="advice-text">{{item}}</text>
          </view>
        </view>
      </view>
    </view>
    
    <!-- è°ƒè¯•é¢æ¿(å¼€å‘ç¯å¢ƒ) -->
    <view class="debug-panel">
      <text class="debug-title">è°ƒè¯•ä¿¡æ¯</text>
      <text class="debug-info">hasUserInfo: {{hasUserInfo}}</text>
      <text class="debug-info">isProfileComplete: {{isProfileComplete}}</text>
      <text class="debug-info">userInfo: {{userInfo ? 'æœ‰æ•°æ®' : 'æ— æ•°æ®'}}</text>
      <text class="debug-info">userProfile: {{userProfile ? 'æœ‰æ•°æ®' : 'æ— æ•°æ®'}}</text>
    </view>
  </view>
</scroll-view>
