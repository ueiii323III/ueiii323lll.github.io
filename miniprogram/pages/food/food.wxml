<!--food.wxml-->
<navigation-bar title="é¥®é£Ÿè®°å½•" back="{{true}}" color="white" background="#FF9800"></navigation-bar>
<scroll-view class="scrollarea" scroll-y type="list">
  <view class="container">
    <!-- ä»Šæ—¥ç»Ÿè®¡ -->
    <view class="stats-section">
      <view class="calorie-stats">
        <view class="calorie-circle">
          <view class="circle-bg">
            <view class="circle-progress" style="background: conic-gradient(#FF9800 {{progress * 3.6}}deg, #e0e0e0 0deg);">
              <view class="circle-inner">
                <text class="calorie-value">{{totalCalories}}</text>
                <text class="calorie-unit">kcal</text>
              </view>
            </view>
          </view>
        </view>
        
        <view class="calorie-info">
          <text class="calorie-label">ä»Šæ—¥çƒ­é‡æ‘„å…¥</text>
          <text class="calorie-range">ç›®æ ‡: {{targetMinCalories}}-{{targetMaxCalories}} kcal</text>
        </view>
      </view>
    </view>

    <!-- è®°å½•è¡¨å• -->
    <view class="form-section">
      <view class="section-title">è®°å½•é¥®é£Ÿ</view>
      
      <!-- é¤æ¬¡é€‰æ‹© -->
      <view class="form-group">
        <text class="form-label">é¤æ¬¡</text>
        <view class="meal-types">
          <view wx:for="{{mealTypes}}" wx:key="value" 
                class="meal-type-item {{mealType === item.value ? 'selected' : ''}}"
                bindtap="onMealTypeChange"
                data-value="{{item.value}}">
            <text class="meal-icon">{{item.icon}}</text>
            <text class="meal-label">{{item.label}}</text>
          </view>
        </view>
      </view>
      
      <!-- é£Ÿç‰©åç§° -->
      <view class="form-group">
        <text class="form-label">é£Ÿç‰©åç§°</text>
        <view class="food-input-wrapper">
          <input class="food-input" 
                 placeholder="è¯·è¾“å…¥é£Ÿç‰©åç§°" 
                 value="{{foodName}}" 
                 bindinput="onFoodNameInput" />
          
          <!-- é£Ÿç‰©å»ºè®®åˆ—è¡¨ -->
          <view wx:if="{{showSuggestions}}" class="food-suggestions">
            <view wx:for="{{foodSuggestions}}" wx:key="*this" 
                  class="suggestion-item"
                  bindtap="selectFoodSuggestion"
                  data-food="{{item}}">
              <text>{{item}}</text>
            </view>
          </view>
        </view>
      </view>
      
      <!-- æ‘„å…¥é‡å’Œå•ä½ -->
      <view class="form-group">
        <text class="form-label">æ‘„å…¥é‡</text>
        <view class="amount-input-wrapper">
          <input class="amount-input" 
                 type="digit" 
                 placeholder="è¯·è¾“å…¥æ‘„å…¥é‡" 
                 value="{{amount}}" 
                 bindinput="onAmountInput" />
          
          <picker mode="selector" range="{{units}}" bindchange="onUnitChange">
            <view class="unit-picker">
              <text>{{unit}}</text>
              <text class="picker-arrow">â–¼</text>
            </view>
          </picker>
        </view>
        
        <!-- çƒ­é‡è®¡ç®—ç»“æœ -->
        <view wx:if="{{showCalculatedResult}}" class="calorie-result">
          <text class="calorie-text">çº¦ {{calculatedCalories}} kcal</text>
        </view>
      </view>
      
      <!-- æ—¶é—´é€‰æ‹© -->
      <view class="form-group">
        <text class="form-label">ç”¨é¤æ—¶é—´</text>
        <picker mode="time" value="{{selectedTime}}" bindchange="onTimeChange">
          <view class="time-picker">
            <text class="time-text">{{selectedTime}}</text>
            <text class="time-arrow">ğŸ•’</text>
          </view>
        </picker>
      </view>
      
      <!-- ç…§ç‰‡ä¸Šä¼  -->
      <view class="form-group">
        <text class="form-label">ç…§ç‰‡ï¼ˆå¯é€‰ï¼‰</text>
        <view class="photo-section">
          <view wx:if="{{photo}}" class="photo-preview">
            <image src="{{photo}}" mode="aspectFill" class="preview-image"></image>
            <view class="photo-delete" bindtap="chooseImage">
              <text>é‡æ–°é€‰æ‹©</text>
            </view>
          </view>
          <view wx:else class="photo-upload" bindtap="chooseImage">
            <text class="upload-icon">ğŸ“·</text>
            <text class="upload-text">æ·»åŠ ç…§ç‰‡</text>
          </view>
        </view>
      </view>
      
      <!-- æäº¤æŒ‰é’® -->
      <button class="submit-btn" bindtap="addFoodRecord">
        ğŸ½ï¸ è®°å½•é¥®é£Ÿ
      </button>
    </view>

    <!-- ä»Šæ—¥è®°å½• -->
    <view class="records-section">
      <view class="section-title">
        <text>ä»Šæ—¥è®°å½•</text>
        <text class="record-count">{{todayRecords.length}}æ¡</text>
      </view>
      
      <view wx:if="{{todayRecords.length === 0}}" class="empty-records">
        <view class="empty-icon">ğŸ½ï¸</view>
        <text class="empty-text">ä»Šæ—¥è¿˜æ²¡æœ‰é¥®é£Ÿè®°å½•</text>
        <text class="empty-desc">ç‚¹å‡»ä¸Šæ–¹å¼€å§‹è®°å½•æ‚¨çš„é¥®é£Ÿ</text>
      </view>
      
      <view wx:else class="records-list">
        <view wx:for="{{todayRecords}}" wx:key="id" class="record-item">
          <view class="record-header">
            <view class="meal-info">
              <text class="meal-icon">{{mealTypes[item.mealType].icon}}</text>
              <text class="meal-type">{{getMealTypeText(item.mealType)}}</text>
            </view>
            <text class="record-time">{{item.time}}</text>
          </view>
          
          <view class="record-content">
            <view class="food-info">
              <text class="food-name">{{item.foodName}}</text>
              <text class="food-amount">{{item.amount}}{{item.unit}}</text>
            </view>
            <view class="calorie-info">
              <text class="calories">{{item.calories}} kcal</text>
            </view>
          </view>
          
          <view wx:if="{{item.photo}}" class="record-photo">
            <image src="{{item.photo}}" mode="aspectFill" class="food-photo"></image>
          </view>
          
          <view class="record-footer">
            <text class="record-created">{{formatDateTime(item.createdAt)}}</text>
            <view class="delete-btn" bindtap="showDeleteConfirm" data-record="{{item}}">
              ğŸ—‘ï¸
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- å¥åº·æç¤º -->
    <view class="tips-section">
      <view class="section-title">é¥®é£Ÿå»ºè®®</view>
      <view class="tips-list">
        <view class="tip-item">
          <text class="tip-icon">ğŸ’¡</text>
          <text class="tip-text">å‡è¡¡é¥®é£Ÿï¼Œå¤šåƒè”¬èœæ°´æœï¼Œæ§åˆ¶æ²¹ç›ç³–æ‘„å…¥</text>
        </view>
        <view class="tip-item">
          <text class="tip-icon">ğŸ’¡</text>
          <text class="tip-text">ç»†åš¼æ…¢å’½ï¼Œæœ‰åŠ©äºæ¶ˆåŒ–å’Œæ§åˆ¶é£Ÿé‡</text>
        </view>
        <view class="tip-item">
          <text class="tip-icon">ğŸ’¡</text>
          <text class="tip-text">å®šæ—¶å®šé‡è¿›é¤ï¼Œé¿å…æš´é¥®æš´é£Ÿ</text>
        </view>
      </view>
    </view>
  </view>
</scroll-view>

<!-- åˆ é™¤ç¡®è®¤å¼¹çª— -->
<view wx:if="{{showDeleteConfirm}}" class="delete-modal">
  <view class="modal-overlay" bindtap="hideDeleteConfirm"></view>
  <view class="modal-content">
    <view class="modal-header">
      <text class="modal-title">ç¡®è®¤åˆ é™¤</text>
    </view>
    <view class="modal-body">
      <text class="modal-message">ç¡®å®šè¦åˆ é™¤è¿™æ¡é¥®é£Ÿè®°å½•å—ï¼Ÿ</text>
      <text wx:if="{{recordToDelete}}" class="modal-detail">
        {{recordToDelete.foodName}} - {{recordToDelete.amount}}{{recordToDelete.unit}}
      </text>
    </view>
    <view class="modal-actions">
      <button class="modal-btn cancel-btn" bindtap="hideDeleteConfirm">å–æ¶ˆ</button>
      <button class="modal-btn confirm-btn" bindtap="confirmDelete">åˆ é™¤</button>
    </view>
  </view>
</view>